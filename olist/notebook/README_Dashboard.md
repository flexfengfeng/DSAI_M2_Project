# 巴西各地区平均送货时间分析仪表盘

这是一个基于Web的交互式仪表盘，用于分析巴西各地区的平均送货时间数据。

## 📊 功能特性

### 🎯 核心功能
- **交互式地图**: 显示巴西各地区送货时间分布，圆点大小和颜色表示送货时间长短
- **数据筛选**: 支持按州、送货时间分类和最小订单数进行筛选
- **多维度分析**: 提供柱状图、饼图和直方图等多种图表类型
- **实时统计**: 显示覆盖地区数、州数、平均送货天数等关键指标

### 🎨 界面布局
```
┌─────────────────────────────────────────────────────────┐
│                    标题栏和更新时间                        │
├──────────────┬──────────────────────────────────────────┤
│              │                                          │
│   筛选面板    │              地图区域                     │
│              │                                          │
│  • 数据摘要   │                                          │
│  • 州选择器   │                                          │
│  • 分类选择器  │                                          │
│  • 订单数滑块  │                                          │
│              ├──────────────────────────────────────────┤
│              │        图表区域 (3个并排)                  │
│              │  柱状图  │  饼图   │  直方图               │
└──────────────┴──────────────────────────────────────────┘
```

## 🚀 快速开始

### 方法一：一键运行（推荐）
```bash
cd /Users/fengfeng/Dev/5m-data-2.5-data-warehouse/olist/notebook
python run_dashboard.py
```

### 方法二：分步运行
1. **生成数据文件**
   ```bash
   python dashboard_data_generator.py
   ```

2. **启动HTTP服务器**
   ```bash
   python -m http.server 8000
   ```

3. **打开浏览器访问**
   ```
   http://localhost:8000/delivery_dashboard_enhanced.html
   ```

## 📁 文件说明

| 文件名 | 说明 |
|--------|------|
| `delivery_dashboard_enhanced.html` | 主仪表盘HTML文件 |
| `dashboard_data_generator.py` | 数据生成器（从BigQuery获取数据） |
| `run_dashboard.py` | 一键运行脚本 |
| `dashboard_data.json` | 生成的数据文件（自动创建） |
| `geo_delivery_dashboard2.ipynb` | 原始Jupyter notebook |

## 🎛️ 使用说明

### 左侧筛选面板
1. **数据摘要**: 显示当前筛选条件下的统计信息
2. **州选择器**: 多选框选择要显示的州
3. **送货时间分类**: 选择快速/中等/慢速/很慢等分类
4. **最小订单数**: 滑块调整显示的最小订单数阈值

### 右侧地图区域
- **交互操作**: 缩放、拖拽、点击查看详情
- **图例说明**: 颜色表示送货时间，圆点大小表示相对时间长短
- **悬停提示**: 显示城市、州、邮编、送货天数、订单数等详细信息

### 下方图表区域
1. **各州平均送货天数**: 柱状图比较不同州的送货效率
2. **送货时间分类分析**: 饼图显示各时间分类的占比
3. **送货天数分布**: 直方图展示送货时间的分布情况

## 🔧 技术架构

### 前端技术
- **HTML5 + CSS3**: 响应式布局和现代化UI设计
- **JavaScript ES6+**: 交互逻辑和数据处理
- **Plotly.js**: 图表渲染和交互

### 后端技术
- **Python 3.7+**: 数据处理和服务器
- **Google Cloud BigQuery**: 数据源
- **Pandas**: 数据分析和处理
- **HTTP Server**: 静态文件服务

### 数据流程
```
BigQuery → Python脚本 → JSON文件 → HTML页面 → 用户界面
```

## 📊 数据说明

### 数据来源
- **主要来源**: Google Cloud BigQuery (`brazil-olist.dbt_output.fct_delivery_time_by_zip`)
- **备用数据**: 内置示例数据（当BigQuery不可用时）

### 数据字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| `zip_code_prefix` | String | 邮编前缀 |
| `avg_latitude` | Float | 平均纬度 |
| `avg_longitude` | Float | 平均经度 |
| `city` | String | 城市名称 |
| `state` | String | 州代码 |
| `avg_delivery_days` | Float | 平均送货天数 |
| `delivery_category` | String | 送货时间分类 |
| `order_count` | Integer | 订单数量 |

### 分类标准
- **快速**: ≤ 10天
- **中等**: 11-15天
- **慢速**: 16-20天
- **很慢**: > 20天

## 🛠️ 自定义配置

### 修改数据源
编辑 `dashboard_data_generator.py` 中的查询语句：
```python
query = f"""
    SELECT 
        -- 自定义字段
    FROM `{PROJECT_ID}.your_table`
    WHERE -- 自定义条件
"""
```

### 调整图表样式
修改 `delivery_dashboard_enhanced.html` 中的CSS样式或Plotly配置。

### 更改服务器端口
```python
python run_dashboard.py --port 9000
```

## 🐛 故障排除

### 常见问题

1. **BigQuery连接失败**
   - 检查Google Cloud认证配置
   - 确认项目ID和表名正确
   - 系统会自动使用示例数据

2. **端口被占用**
   - 修改端口号：`python -m http.server 9000`
   - 或终止占用端口的进程

3. **浏览器无法访问**
   - 检查防火墙设置
   - 尝试使用 `127.0.0.1` 替代 `localhost`

4. **图表不显示**
   - 检查网络连接（需要加载Plotly.js）
   - 确认数据文件格式正确

### 调试模式
在浏览器中按F12打开开发者工具查看控制台错误信息。

## 📈 性能优化

### 数据量优化
- 默认限制1000条记录
- 可在数据生成器中调整 `LIMIT` 值
- 建议根据服务器性能调整

### 加载速度优化
- 数据文件缓存机制
- 图表懒加载
- 响应式设计适配移动端

## 🔄 更新日志

### v1.0.0 (当前版本)
- ✅ 基础仪表盘功能
- ✅ 交互式地图和图表
- ✅ 数据筛选功能
- ✅ 响应式设计
- ✅ 一键运行脚本

### 计划功能
- 🔲 数据导出功能
- 🔲 更多图表类型
- 🔲 时间序列分析
- 🔲 用户偏好设置

## 📞 支持

如有问题或建议，请联系开发团队或提交Issue。

---

**最后更新**: 2024年12月
**版本**: 1.0.0
**兼容性**: Chrome 80+, Firefox 75+, Safari 13+